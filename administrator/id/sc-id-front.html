<?php
    if(isset($_GET['person_id'])) {
        $page = "print-id";
        require_once '../includes/dbh.inc.php';
        require_once '../includes/sql.inc.php';
        $person_id = $_GET['person_id'];
        $person = getSeniorCitizenData($connection, $person_id);
        $genderData = getSeniorCitizenGender($connection, $person_id);
        $idData = getIDData($connection, $person_id);
        $result = array_map(null, $person, $genderData, $idData);
    } else {
        header("location: ../print-id.html");
        exit();
    }
?>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>ID</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>

<body>
    <?php foreach($result as list($data, $gender, $idData)): ?>
    <div class="d-flex d-flex align-items-center justify-content-center">
        <div id="id" class="mx-auto mt-5 p-3" style="height: 240px;width: 365px;">
            <div class="row">
                <div class="col col-2"><img src="assets/img/santarosa-logo.png" width="50px" height="50px" style="padding-right: 0px;padding-left: 0px;"></div>
                <div class="col text-center" style="padding-left: 0px;padding-right: 0px;">
                    <p style="font-size: 7px;">Republic of the Philippines</p>
                    <p style="font-size: 9px;"><strong>CITY</strong>&nbsp;<strong>OF SANTA ROSA</strong></p>
                    <p style="font-size: 7px;">Province of Laguna</p>
                    <h6 style="font-size: 8px;">OFFICE OF THE SENIOR CITIZENS AFFAIRS</h6>
                </div>
                <div class="col col-2" id="pdao-icon"><img id="pdao" src="assets/img/sclogo.png" width="50px" height="50px" style="padding-right: 3px;"></div>
            </div>
            <div class="row mt-4" style="margin-bottom: -7px;">
                <div class="col d-flex align-items-center justify-content-center">
                    <div id="information">
                        <div class="row">
                            <div class="col">
                                <p style="font-size: 10px;">Name:<strong style="margin-left: 10px;font-size: 10px;"><?php echo(strtoupper($data['FIRST_NAME']." ".$data['MIDDLE_NAME']." ".$data['LAST_NAME']." ".$data['SUFFIX'])); ?></strong></p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <p style="font-size: 10px;">Address:<strong style="margin-left: 10px;font-size: 10px;"><?php echo(strtoupper($data['ADDRESS']." BARANGAY ".$data['BARANGAY']." SANTA ROSA LAGUNA")); ?></strong></p>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <p style="font-size: 10px;">Date Of Birth:<strong style="margin-left: 10px;font-size: 10px;"><?php 
                                    $date_str = strtoupper(date('F j, Y', strtotime($data['DATE_OF_BIRTH'])));
                                    $date = DateTime::createFromFormat('F j, Y', $date_str);
                                    $formatted_date = $date->format('M. j, Y');
                                    echo strtoupper($formatted_date);
                                    ?></strong></p>
                            </div>
                            <div class="col col-3">
                                <p style="font-size: 10px;">Gender:<strong style="margin-left: 10px;font-size: 10px;"><?php echo(strtoupper($gender['GENDER'][0])); ?></strong></p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col col-4 d-flex align-items-center justify-content-center p-2"><img id="picture" width="96px" height="96px" src="assets/img/default%20profile%20picture.png" style="padding-left: 0px;padding-right: 0px;margin-left: -15px;"></div>
            </div>
            <div class="row">
                <div class="col text-center" style="padding-top: 10px;">
                    <p style="font-size: 8px;"><strong style="font-size: 9px;">________________________________________</strong></p>
                    <p style="font-size: 8px;">Signature / Thumbmark</p>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <p style="font-size: 10px;">ID&nbsp;Card No.:&nbsp;<strong style="font-size: 10px;color: var(--bs-red);text-decoration: underline;"><?php echo(substr($idData['USERNAME'], 3)) ?></strong></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <p style="font-size: 10px;">Date Issued: <strong style="text-decoration: underline;"><?php 
                                $date_str = strtoupper(date('F j, Y'));
                                $date = DateTime::createFromFormat('F j, Y', $date_str);
                                $formatted_date = $date->format('M. j, Y');
                                echo strtoupper($formatted_date);
                                ?></strong></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <?php endforeach; ?>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>